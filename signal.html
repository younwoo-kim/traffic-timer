<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì‹ í˜¸ë“± íƒ€ì´ë¨¸</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; padding: 20px; color: white;
    }
    .container {
      max-width: 400px; margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 20px; padding: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    h1 { text-align: center; margin-bottom: 30px; font-size: 28px; font-weight: 700; }
    .setup-section { margin-bottom: 30px; }
    .input-group { margin-bottom: 20px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 16px; }
    input {
      width: 100%; padding: 12px 16px; border: none; border-radius: 12px;
      background: rgba(255,255,255,0.9); color: #333; font-size: 16px; outline: none;
    }
    button {
      width: 100%; padding: 12px;
      background: rgba(255, 255, 255, 0.2);
      color: white; border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px; font-size: 16px; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease;
    }
    button:hover { background: rgba(255,255,255,0.3); transform: translateY(-2px); }

    /* 2ë²ˆì§¸ ì‹ í˜¸ë“± ë²„íŠ¼ ê°•ì¡° ìƒ‰ìƒ */
    .btn-second {
      background: rgba(255, 255, 255, 0.35);
      border-color: rgba(255, 255, 255, 0.55);
    }
    .btn-second:hover { background: rgba(255,255,255,0.45); }

    .time-display { text-align: center; margin: 30px 0; }
    .current-time { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: #fff; }
    .next-signals {
      background: rgba(255,255,255,0.15);
      border-radius: 16px; padding: 20px; margin-top: 20px;
    }
    .signal-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.2);
    }
    .signal-item:last-child { border-bottom: none; }
    .signal-label { font-weight: 600; font-size: 16px; }
    .signal-time { font-size: 18px; font-weight: 700; color: #ffeb3b; }
    .countdown { font-size: 14px; color: #e0e0e0; margin-top: 4px; }
    .hidden { display: none; }
    .row-gap { display: grid; gap: 12px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš¦ ì‹ í˜¸ë“± íƒ€ì´ë¨¸</h1>

    <!-- ì„¤ì • ì˜ì—­ (ìë™ ì‹œì‘ í›„ ë°”ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬ë¨) -->
    <div class="setup-section" id="setupSection">
      <div class="input-group">
        <label for="baseTime">ê¸°ì¤€ ì‹ í˜¸ ì‹œê°„ (ì˜ˆ: 07:19:15)</label>
        <input type="time" id="baseTime" step="1" value="07:19:15">
      </div>

      <div class="row-gap">
        <div class="input-group">
          <label for="cycleMinutes">ì‹ í˜¸ ì£¼ê¸° (ë¶„)</label>
          <input type="number" id="cycleMinutes" value="2" min="1" max="10">
        </div>

        <div class="input-group">
          <label for="cycleSeconds">ì‹ í˜¸ ì£¼ê¸° (ì´ˆ)</label>
          <input type="number" id="cycleSeconds" value="40" min="0" max="59">
        </div>
      </div>
      <!-- ìë™ ì‹œì‘ì´ë¯€ë¡œ ì´ ë²„íŠ¼ì€ ì´ˆê¸°ì—” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ -->
      <!-- <button id="btnStart">íƒ€ì´ë¨¸ ì‹œì‘</button> -->
    </div>

    <!-- íƒ€ì´ë¨¸ í‘œì‹œ -->
    <div id="timerDisplay" class="hidden">
      <div class="time-display">
        <div class="current-time" id="currentTime"></div>

        <div class="next-signals">
          <div class="signal-item">
            <div class="signal-label">ë‹¤ìŒ ì‹ í˜¸</div>
            <div>
              <div class="signal-time" id="nextSignal"></div>
              <div class="countdown" id="nextCountdown"></div>
            </div>
          </div>

          <div class="signal-item">
            <div class="signal-label">ë‹¤ë‹¤ìŒ ì‹ í˜¸</div>
            <div>
              <div class="signal-time" id="nextNextSignal"></div>
              <div class="countdown" id="nextNextCountdown"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- ìš”êµ¬ì‚¬í•­: ë²„íŠ¼ ë¼ë²¨/ìƒ‰ë§Œ ë³€ê²½, ë˜ëŒë¦¼ ì—†ìŒ, ì—¬ëŸ¬ ë²ˆ ëˆŒëŸ¬ë„ 1íšŒë§Œ ì ìš© -->
      <div class="row-gap" style="margin-top: 16px;">
        <button class="btn-second" id="btnSecond">2ë²ˆì§¸ ì‹ í˜¸ë“±</button>
        <button id="btnReset">ì„¤ì • ë³€ê²½</button>
      </div>
    </div>
  </div>

  <script>
    let timerInterval = null;
    let baseTime;              // Date
    let cycleSeconds = 0;      // number
    let isRunning = false;     // ì¸í„°ë²Œ ì¤‘ë³µ ë°©ì§€
    let offsetSeconds = 0;     // ì˜¤í”„ì…‹(ì´ˆ) - ê¸°ë³¸ 0
    let secondApplied = false; // 2ë²ˆì§¸ ì‹ í˜¸ë“± ì ìš© ì—¬ë¶€(1íšŒì„±)

    // === í•µì‹¬: ìë™ ì‹œì‘ ===
    document.addEventListener('DOMContentLoaded', () => {
      // ì…ë ¥ê°’ì´ ë¹„ì–´ ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ê¸°ë³¸ê°’ì„ ë³´ì¥
      const baseInput = document.getElementById('baseTime');
      if (!baseInput.value) baseInput.value = '07:19:15';

      const m = document.getElementById('cycleMinutes');
      const s = document.getElementById('cycleSeconds');
      if (!m.value) m.value = '2';
      if (!s.value) s.value = '40';

      // ì•½ê°„ì˜ ì§€ì—° í›„ ìë™ ì‹œì‘(ë Œë” ì™„ë£Œ ì•ˆì •í™”)
      setTimeout(() => {
        startTimer();
      }, 100);
    });

    // 2ë²ˆì§¸ ì‹ í˜¸ë“±(ì˜¤í”„ì…‹ +9ì´ˆ) ì ìš©
    document.getElementById('btnSecond').addEventListener('click', () => {
      if (secondApplied) return;      // ì—¬ëŸ¬ ë²ˆ ëˆŒëŸ¬ë„ 1íšŒë§Œ ë°˜ì˜
      offsetSeconds = 9;              // ê³ ì • ì˜¤í”„ì…‹
      secondApplied = true;
      // ì¦‰ì‹œ ë°˜ì˜ì„ ìœ„í•´ í•œ ë²ˆ ì—…ë°ì´íŠ¸
      updateTimer();
    });

    // ì„¤ì • ë³€ê²½(ì´ˆê¸° í™”ë©´ìœ¼ë¡œ ë³µê·€)
    document.getElementById('btnReset').addEventListener('click', () => {
      stopTimer();
      // ìƒíƒœ ì´ˆê¸°í™”(ìš”êµ¬ì‚¬í•­: ì¬ë¡œë“œ/ì´ˆê¸°í™” ì‹œ 1ë²ˆì§¸ ìƒíƒœ)
      offsetSeconds = 0;
      secondApplied = false;

      document.getElementById('setupSection').classList.remove('hidden');
      document.getElementById('timerDisplay').classList.add('hidden');
    });

    function startTimer() {
      if (isRunning) return;

      const baseTimeInput = document.getElementById('baseTime').value;
      const cycleMinutes = parseInt(document.getElementById('cycleMinutes').value || '0', 10);
      const cycleSecs = parseInt(document.getElementById('cycleSeconds').value || '0', 10);

      if (!baseTimeInput || isNaN(cycleMinutes) || isNaN(cycleSecs)) {
        alert('ê¸°ì¤€ ì‹œê°„ê³¼ ì£¼ê¸°ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return;
      }

      // ê¸°ì¤€ ì‹œê°„ì„ ì˜¤ëŠ˜ ë‚ ì§œë¡œ ë³€í™˜
      const today = new Date();
      const [hours, minutes, seconds] = baseTimeInput.split(':').map(Number);
      baseTime = new Date(
        today.getFullYear(),
        today.getMonth(),
        today.getDate(),
        hours, minutes, seconds
      );

      cycleSeconds = (cycleMinutes * 60) + cycleSecs;

      // UI ì „í™˜: ì„¤ì • ìˆ¨ê¹€, í‘œì‹œ ë³´ì„
      document.getElementById('setupSection').classList.add('hidden');
      document.getElementById('timerDisplay').classList.remove('hidden');

      // ìƒíƒœ í”Œë˜ê·¸ ë° íƒ€ì´ë¨¸ ì‹œì‘
      isRunning = true;
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      isRunning = false;
    }

    function updateTimer() {
      const now = new Date();

      // í˜„ì¬ ì‹œê°„ í‘œì‹œ
      document.getElementById('currentTime').textContent =
        now.toLocaleTimeString('ko-KR', { hour12: false });

      // ê¸°ì¤€ ì‹œê°ìœ¼ë¡œë¶€í„° ê²½ê³¼ ì´ˆ
      const elapsed = Math.floor((now - baseTime) / 1000);

      // í˜„ì¬ ì‚¬ì´í´ ì¸ë±ìŠ¤
      const currentCycle = Math.floor(elapsed / cycleSeconds);

      // ë‹¤ìŒ/ë‹¤ë‹¤ìŒ ì‹ í˜¸ ì‹œê°(ì˜¤í”„ì…‹ ë°˜ì˜)
      const nextSignalTime = new Date(
        baseTime.getTime() +
        (currentCycle + 1) * cycleSeconds * 1000 +
        offsetSeconds * 1000
      );
      const nextNextSignalTime = new Date(
        baseTime.getTime() +
        (currentCycle + 2) * cycleSeconds * 1000 +
        offsetSeconds * 1000
      );

      // í‘œì‹œ
      document.getElementById('nextSignal').textContent =
        nextSignalTime.toLocaleTimeString('ko-KR', { hour12: false });
      document.getElementById('nextNextSignal').textContent =
        nextNextSignalTime.toLocaleTimeString('ko-KR', { hour12: false });

      // ì¹´ìš´íŠ¸ë‹¤ìš´
      const timeToNext = Math.floor((nextSignalTime - now) / 1000);
      const timeToNextNext = Math.floor((nextNextSignalTime - now) / 1000);

      document.getElementById('nextCountdown').textContent =
        `${Math.max(0, Math.floor(timeToNext / 60))}ë¶„ ${Math.max(0, timeToNext % 60)}ì´ˆ í›„`;
      document.getElementById('nextNextCountdown').textContent =
        `${Math.max(0, Math.floor(timeToNextNext / 60))}ë¶„ ${Math.max(0, timeToNextNext % 60)}ì´ˆ í›„`;
    }

    // íƒ­ ì „í™˜ ì‹œ ì¸í„°ë²Œ ê´€ë¦¬
    document.addEventListener('visibilitychange', function () {
      if (document.hidden) {
        // ë°±ê·¸ë¼ìš´ë“œ: íƒ€ì´ë¨¸ ì •ì§€
        stopTimer();
      } else {
        // í¬ì–´ê·¸ë¼ìš´ë“œ ë³µê·€: í‘œì‹œ ì˜ì—­ì´ ë³´ì´ëŠ” ìƒíƒœë©´ ì¬ì‹œì‘
        const displayVisible = !document.getElementById('timerDisplay').classList.contains('hidden');
        if (displayVisible && !isRunning) {
          isRunning = true;
          updateTimer();
          timerInterval = setInterval(updateTimer, 1000);
        }
      }
    });
  </script>
</body>
</html>
